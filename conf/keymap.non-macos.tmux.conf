# decide whether we're in a Vim process
# See: https://github.com/christoomey/vim-tmux-navigator/blob/a26954a585b02a2ac02f87145e204f8798a7cbc2/vim-tmux-navigator.tmux#L1
_tmux_is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?(\\.exe)?$'"

## Functions
bind-key -n M-F11             set-option status      # Toggle status bar visibility

## Session
bind-key -n M-C-d             detach-client
bind-key -n M-C-n             command-prompt -p "New session name:" -I "#{session_name}-2" "new-session -s '%%'"
bind-key -n M-C-s             choose-tree -s
bind-key -n M-','             run-shell "bash ~/.config/tmux/script/focus-session.sh prev"
bind-key -n M-'.'             run-shell "bash ~/.config/tmux/script/focus-session.sh next"

## Window/Pane
bind-key -n M-C-l             split-window -h -c '#{pane_current_path}'   # Split Vertical a new pane will created right of current pane with current directory.
bind-key -n M-C-j             split-window -v -c '#{pane_current_path}'   # Split horizontal, a new pane will created below of current pane with current directory.
bind-key -n M-O               kill-window -a                              # Close other window.
bind-key -n M-W               kill-window                                 # Close window.
bind-key -n M-M               command-prompt -p "Move window to session:" -I "#{session_name}" 'run-shell "bash ~/.config/tmux/script/move-window.sh '%%'"'
bind-key -n M-m               command-prompt -p "Move pane to window:" -I "#{window_name}" "join-pane -t :'%%'" # Move pane to window with window number or name
bind-key -n M-n               command-prompt -p "New window name:" -I "#{window_name}-2" "new-window -n '%%'" # Create new window
bind-key -n M-w               kill-pane                                   # Close pane.

### Focus
bind-key -n M-k               if-shell "$_tmux_is_vim" 'send-keys M-k' 'select-pane -U'
bind-key -n M-l               if-shell "$_tmux_is_vim" 'send-keys M-l' 'select-pane -R'
bind-key -n M-j               if-shell "$_tmux_is_vim" 'send-keys M-j' 'select-pane -D'
bind-key -n M-h               if-shell "$_tmux_is_vim" 'send-keys M-h' 'select-pane -L'
bind-key -n M-1               select-window -t 1
bind-key -n M-2               select-window -t 2
bind-key -n M-3               select-window -t 3
bind-key -n M-4               select-window -t 4
bind-key -n M-5               select-window -t 5
bind-key -n M-6               select-window -t 6
bind-key -n M-7               select-window -t 7
bind-key -n M-8               select-window -t 8
bind-key -n M-9               select-window -t 9
bind-key -n M-0               select-window -t 10
bind-key -n M-'['             previous-window
bind-key -n M-']'             next-window

### Resize
bind-key -n -r M-Up           resize-pane -U 1
bind-key -n -r M-Right        resize-pane -R 1
bind-key -n -r M-Down         resize-pane -D 1
bind-key -n -r M-Left         resize-pane -L 1
bind-key -n -r M-z            resize-pane -Z
bind-key -n -r M-C-z          resize-pane -Z

### Swap
bind-key -n M-K               swap-pane     -t '{up-of}'      \; select-pane -t '{down-of}'
bind-key -n M-L               swap-pane     -t '{right-of}'   \; select-pane -t '{left-of}'
bind-key -n M-J               swap-pane     -t '{down-of}'    \; select-pane -t '{up-of}'
bind-key -n M-H               swap-pane     -t '{left-of}'    \; select-pane -t '{right-of}'
bind-key -n M-'{'             swap-window   -t -1             \; previous-window
bind-key -n M-'}'             swap-window   -t +1             \; next-window
bind-key -n M-C-Right         select-layout "even-horizontal"
bind-key -n M-C-Down          select-layout "even-vertical"

## Misc
bind-key -n M-T               if-shell "$_tmux_is_vim" 'run-shell "tmux send-keys M-T; bash ~/.config/tmux/script/toggle-theme.sh"' 'run-shell "bash ~/.config/tmux/script/toggle-theme.sh"'
bind-key -n M-c               if-shell "$_tmux_is_vim" 'send-keys M-c' copy-mode
bind-key -n M-g               if-shell "$_tmux_is_vim" 'send-keys M-g' 'display-popup -d "#{pane_current_path}" -w80% -h80% -E lazygit'  # Display lazygit
bind-key -n M-o               if-shell "$_tmux_is_vim" 'send-keys M-o' 'run-shell "open #{pane_current_path}"'       # open current path in finder.
bind-key -n M-r               if-shell "$_tmux_is_vim" 'send-keys M-r' "run-shell 'tmux source-file ~/.config/tmux/tmux.conf; tmux display-message \"Config reloaded..\"'"
bind-key -n M-t               if-shell "$_tmux_is_vim" 'send-keys M-t' 'run-shell "bash ~/.config/tmux/script/popup.sh"'
bind-key -n M-:               command-prompt -p ":" "send-keys ':' Enter"

